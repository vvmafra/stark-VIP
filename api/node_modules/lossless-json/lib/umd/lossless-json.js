!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LosslessJSON={})}(this,(function(t){"use strict";function e(t){return n.test(t)}const n=/^-?[0-9]+$/;function r(t){return o.test(t)}const o=/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?$/;function i(t,n){if(e(t))return Number.isSafeInteger(Number.parseInt(t,10));const r=Number.parseFloat(t),o=String(r);if(t===o)return!0;const i=f(t),u=f(o);if(i===u)return!0;if(!0===n?.approx){const n=14;if(!e(t)&&u.length>=n&&i.startsWith(u.substring(0,n)))return!0}return!1}let u=function(t){return t.underflow="underflow",t.overflow="overflow",t.truncate_integer="truncate_integer",t.truncate_float="truncate_float",t}({});function c(t){if(i(t,{approx:!1}))return;if(e(t))return u.truncate_integer;const n=Number.parseFloat(t);return Number.isFinite(n)?0===n?u.underflow:u.truncate_float:u.overflow}function s(t){const e=t.match(/^(-?)(\d+\.?\d*)([eE]([+-]?\d+))?$/);if(!e)throw new SyntaxError(`Invalid number: ${t}`);const n=e[1],r=e[2];let o=void 0!==e[4]?Number.parseInt(e[4],10):0;const i=r.indexOf(".");o+=-1!==i?i-1:r.length-1;const u=r.replace(".","").replace(/^0*/,(t=>(o-=t.length,""))).replace(/0*$/,"");return u.length>0?{sign:n,digits:u,exponent:o}:{sign:n,digits:"0",exponent:o+1}}function a(t,e){if(t===e)return 0;const n=s(t),r=s(e),o="-"===n.sign?-1:1;return n.sign!==r.sign?"0"===n.digits&&"0"===r.digits?0:o:n.exponent!==r.exponent?n.exponent>r.exponent?o:n.exponent<r.exponent?-o:0:n.digits>r.digits?o:n.digits<r.digits?-o:0}function f(t){const{start:e,end:n}=l(t),r=t.substring(e,n),o=r.indexOf(".");return-1===o?r:r.substring(0,o)+r.substring(o+1)}function l(t){let e=0;for("-"===t[0]&&e++;"0"===t[e]||"."===t[e];)e++;let n=t.lastIndexOf("e");for(-1===n&&(n=t.lastIndexOf("E")),-1===n&&(n=t.length);("0"===t[n-1]||"."===t[n-1])&&n>e;)n--;return{start:e,end:n}}class d{isLosslessNumber=!0;constructor(t){if(!r(t))throw new Error(`Invalid number (value: "${t}")`);this.value=t}valueOf(){const t=c(this.value);if(void 0===t||t===u.truncate_float)return Number.parseFloat(this.value);if(e(this.value))return BigInt(this.value);throw new Error(`Cannot safely convert to number: the value '${this.value}' would ${t} and become ${Number.parseFloat(this.value)}`)}toString(){return this.value}}function h(t){return t&&"object"==typeof t&&t.isLosslessNumber||!1}function p(t){return new d(t)}function y(t,e,n,r){return Array.isArray(n)?r.call(t,e,function(t,e){for(let n=0;n<t.length;n++)t[n]=y(t,String(n),t[n],e);return t}(n,r)):n&&"object"==typeof n&&!h(n)?r.call(t,e,function(t,e){for(const n of Object.keys(t)){const r=y(t,n,t[n],e);void 0!==r?t[n]=r:delete t[n]}return t}(n,r)):r.call(t,e,n)}function b(t){return t>=_&&t<=J||t>=R&&t<=K||t>=Q&&t<=P}function g(t){return t>=_&&t<=J}function m(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every(((t,n)=>m(t,e[n])));if(w(t)&&w(e)){return[...new Set([...Object.keys(t),...Object.keys(e)])].every((n=>m(t[n],e[n])))}return!1}function w(t){return"object"==typeof t&&null!==t}const v={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},x=92,A=123,$=125,N=91,S=93,C=32,E=10,O=9,I=13,j=34,k=43,L=45,_=48,F=49,J=57,D=44,B=46,T=58,R=65,Q=97,U=69,V=101,K=70,P=102;const W=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/;t.LosslessNumber=d,t.UnsafeNumberReason=u,t.compareLosslessNumber=function(t,e){return a(t.value,e.value)},t.compareNumber=a,t.config=function(t){throw new Error("config is deprecated, support for circularRefs is removed from the library. If you encounter circular references in your data structures, please rethink your datastructures: better prevent circular references in the first place.")},t.getUnsafeNumberReason=c,t.isInteger=e,t.isLosslessNumber=h,t.isNumber=r,t.isSafeNumber=i,t.parse=function(t,e,n){const r="function"==typeof n?{parseNumber:n}:n,o=r?.parseNumber??p,i=r?.onDuplicateKey??function(t){let{key:e,position:n}=t;throw new SyntaxError(`Duplicate key '${e}' encountered at position ${n}`)};let u=0;const c=f();return function(t){if(void 0===t)throw new SyntaxError(`JSON value expected ${H()}`)}(c),function(){if(u<t.length)throw new SyntaxError(`Expected end of input ${H()}`)}(),e?function(t,e){return y({"":t},"",t,e)}(c,e):c;function s(){if(t.charCodeAt(u)===A){u++,d();const e={};let n=!0;for(;u<t.length&&t.charCodeAt(u)!==$;){n?n=!1:(w(),d());const t=u,r=h();if(void 0===r)return void P();d(),R();const o=f();if(void 0===o)return void q();if(Object.prototype.hasOwnProperty.call(e,r)&&!m(o,e[r])){const n=i({key:r,position:t+1,oldValue:e[r],newValue:o});void 0!==n&&(e[r]=n)}else e[r]=o}return t.charCodeAt(u)!==$&&function(){throw new SyntaxError(`Quoted object key or end of object '}' expected ${H()}`)}(),u++,e}}function a(){if(t.charCodeAt(u)===N){u++,d();const e=[];let n=!0;for(;u<t.length&&t.charCodeAt(u)!==S;){n?n=!1:w();const t=f();Q(t),e.push(t)}return t.charCodeAt(u)!==S&&function(){throw new SyntaxError(`Array item or end of array ']' expected ${H()}`)}(),u++,e}}function f(){d();const e=h()??function(){const e=u;t.charCodeAt(u)===L&&(u++,K(e));if(t.charCodeAt(u)===_)u++;else if(n=t.charCodeAt(u),n>=F&&n<=J)for(u++;g(t.charCodeAt(u));)u++;var n;if(t.charCodeAt(u)===B)for(u++,K(e);g(t.charCodeAt(u));)u++;if(t.charCodeAt(u)===V||t.charCodeAt(u)===U)for(u++,t.charCodeAt(u)!==L&&t.charCodeAt(u)!==k||u++,K(e);g(t.charCodeAt(u));)u++;if(u>e)return o(t.slice(e,u))}()??s()??a()??l("true",!0)??l("false",!1)??l("null",null);return d(),e}function l(e,n){if(t.slice(u,u+e.length)===e)return u+=e.length,n}function d(){for(;(e=t.charCodeAt(u))===C||e===E||e===O||e===I;)u++;var e}function h(){if(t.charCodeAt(u)===j){u++;let n="";for(;u<t.length&&t.charCodeAt(u)!==j;){if(t.charCodeAt(u)===x){const e=t[u+1],r=v[e];void 0!==r?(n+=r,u++):"u"===e?b(t.charCodeAt(u+2))&&b(t.charCodeAt(u+3))&&b(t.charCodeAt(u+4))&&b(t.charCodeAt(u+5))?(n+=String.fromCharCode(Number.parseInt(t.slice(u+2,u+6),16)),u+=5):z(u):Z(u)}else(e=t.charCodeAt(u))>=32&&e<=1114111?n+=t[u]:W(t[u]);u++}return function(){if(t.charCodeAt(u)!==j)throw new SyntaxError(`End of string '"' expected ${H()}`)}(),u++,n}var e}function w(){if(t.charCodeAt(u)!==D)throw new SyntaxError(`Comma ',' expected after value ${H()}`);u++}function R(){if(t.charCodeAt(u)!==T)throw new SyntaxError(`Colon ':' expected after property name ${H()}`);u++}function Q(t){if(void 0===t)throw new SyntaxError(`Array item expected ${H()}`)}function K(e){if(!g(t.charCodeAt(u))){const n=t.slice(e,u);throw new SyntaxError(`Invalid number '${n}', expecting a digit ${H()}`)}}function P(){throw new SyntaxError(`Quoted object key expected ${H()}`)}function W(t){throw new SyntaxError(`Invalid character '${t}' ${G()}`)}function Z(e){const n=t.slice(e,e+2);throw new SyntaxError(`Invalid escape character '${n}' ${G()}`)}function q(){throw new SyntaxError(`Object value expected after ':' ${G()}`)}function z(e){const n=t.slice(e,e+6);throw new SyntaxError(`Invalid unicode character '${n}' ${G()}`)}function G(){return`at position ${u}`}function H(){return`${u<t.length?`but got '${t[u]}'`:"but reached end of input"} ${G()}`}},t.parseLosslessNumber=p,t.parseNumberAndBigInt=function(t){return e(t)?BigInt(t):Number.parseFloat(t)},t.reviveDate=function(t,e){return"string"==typeof e&&W.test(e)?new Date(e):e},t.splitNumber=s,t.stringify=function t(e,n,o,i){const u=function(t){if("number"==typeof t)return" ".repeat(t);if("string"==typeof t&&""!==t)return t;return}(o);return c("function"==typeof n?n.call({"":e},"",e):e,"");function c(e,a){if(Array.isArray(i)){const t=i.find((t=>t.test(e)));if(t){const n=t.stringify(e);if("string"!=typeof n||!r(n))throw new Error(`Invalid JSON number: output of a number stringifier must be a string containing a JSON number (output: ${n})`);return n}}return"boolean"==typeof e||"number"==typeof e||"string"==typeof e||null===e||e instanceof Date||e instanceof Boolean||e instanceof Number||e instanceof String?JSON.stringify(e):e?.isLosslessNumber||"bigint"==typeof e?e.toString():Array.isArray(e)?function(t,e){if(0===t.length)return"[]";const r=u?e+u:void 0;let o=u?"[\n":"[";for(let e=0;e<t.length;e++){const i="function"==typeof n?n.call(t,String(e),t[e]):t[e];u&&(o+=r),o+=void 0!==i&&"function"!=typeof i?c(i,r):"null",e<t.length-1&&(o+=u?",\n":",")}return o+=u?`\n${e}]`:"]",o}(e,a):e&&"object"==typeof e?function(e,r){if("function"==typeof e.toJSON)return t(e.toJSON(),n,o,void 0);const i=Array.isArray(n)?n.map(String):Object.keys(e);if(0===i.length)return"{}";const a=u?r+u:void 0;let f=!0,l=u?"{\n":"{";for(const t of i){const r="function"==typeof n?n.call(e,t,e[t]):e[t];if(s(t,r)){f?f=!1:l+=u?",\n":",";const e=JSON.stringify(t);l+=u?`${a+e}: `:`${e}:`,l+=c(r,a)}}return l+=u?`\n${r}}`:"}",l}(e,a):void 0}function s(t,e){return void 0!==e&&"function"!=typeof e&&"symbol"!=typeof e}},t.toLosslessNumber=function(t){if(function(t){const{start:e,end:n}=l(t),r=t.indexOf(".");return-1===r||r<e||r>n?n-e:n-e-1}(String(t))>15)throw new Error(`Invalid number: contains more than 15 digits and is most likely truncated and unsafe by itself (value: ${t})`);if(Number.isNaN(t))throw new Error("Invalid number: NaN");if(!Number.isFinite(t))throw new Error(`Invalid number: ${t}`);return new d(String(t))},t.toSafeNumberOrThrow=function(t,e){const n=Number.parseFloat(t),r=c(t);if(!0===e?.approx?r&&r!==u.truncate_float:r){const e=r?.replace(/_\w+$/,"");throw new Error(`Cannot safely convert to number: the value '${t}' would ${e} and become ${n}`)}return n}}));//# sourceMappingURL=lossless-json.js.map
